<!DOCTYPE html>
<html>
<head>
    <title>Bulk Mail Sender</title>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>

<div class="container">
    <h2>ðŸ“¨ Bulk Mail Sender (Pro)</h2>

    <input type="text" id="sender_name" placeholder="Sender Name">
    <input type="email" id="sender_email" placeholder="Your Gmail">
    <input type="password" id="sender_pass" placeholder="App Password (16 digit)">
    <input type="text" id="subject" placeholder="Subject">

    <textarea id="body" rows="6" placeholder="Message"></textarea>

    <textarea id="recipients" rows="6" placeholder="Emails (comma or line separated)"></textarea>

    <button id="sendBtn" onclick="sendMail()">Send</button>
</div>

<!-- POPUP -->
<div id="popupBox"></div>

<script>
function sendMail() {
    const btn = document.getElementById("sendBtn");
    btn.classList.add("sending");
    btn.innerHTML = "Sending...";

    const data = new FormData();
    data.append("sender_name", document.getElementById("sender_name").value);
    data.append("sender_email", document.getElementById("sender_email").value);
    data.append("sender_pass", document.getElementById("sender_pass").value);
    data.append("subject", document.getElementById("subject").value);
    data.append("body", document.getElementById("body").value);
    data.append("recipients", document.getElementById("recipients").value);

    fetch("/send", { method: "POST", body: data })
    .then(res => res.json())
    .then(res => {
        btn.classList.remove("sending");
        btn.classList.add("sent");
        btn.innerHTML = "âœ“ Sent";

        document.getElementById("popupBox").style.display = "block";
        document.getElementById("popupBox").innerHTML =
            `<h3>Mail Report</h3>
            <p>Total: ${res.total}</p>
            <p style='color:green;'>Success: ${res.success}</p>
            <p style='color:red;'>Failed: ${res.failed}</p>
            <button onclick='closePopup()'>OK</button>`;
    });
}

function closePopup() {
    document.getElementById("popupBox").style.display = "none";
}
</script>

</body>
</html>
