<!-- Only the changed part - rest same as before -->
<script>
    // Load email templates
    async function loadTemplates() {
        try {
            const response = await fetch('/api/templates');
            const data = await response.json();
            const templateContainer = document.getElementById('templateSelection');
            
            let templatesHTML = '';
            let first = true;
            
            for (const [key, template] of Object.entries(data.templates)) {
                templatesHTML += `
                    <div class="col-md-3 mb-3">
                        <div class="template-card p-3 ${first ? 'active' : ''}" onclick="selectTemplate('${key}', '${template.subject}')">
                            <h6 class="mb-1">${template.subject}</h6>
                            <small class="text-muted">${template.greeting}</small>
                        </div>
                    </div>
                `;
                if (first) {
                    document.getElementById('subjectInput').value = template.subject;
                    document.getElementById('templateType').value = key;
                    first = false;
                }
            }
            
            templateContainer.innerHTML = templatesHTML;
        } catch (error) {
            console.error('Error loading templates:', error);
        }
    }
    
    function selectTemplate(templateType, subject) {
        // Update active template
        document.querySelectorAll('.template-card').forEach(card => {
            card.classList.remove('active');
        });
        event.currentTarget.classList.add('active');
        
        // Update form values
        document.getElementById('subjectInput').value = subject;
        document.getElementById('templateType').value = templateType;
    }
</script>
