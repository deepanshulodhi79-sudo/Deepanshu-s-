<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Fast Mail Launcher</title>

<style>
    body {
        font-family: Arial;
        background: #eef1f7;
        margin: 0;
        padding: 0;
    }

    .container {
        width: 750px;
        margin: 40px auto;
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }

    h2 { text-align: center; margin-bottom: 20px; }

    input, textarea {
        width: 100%;
        padding: 12px;
        border-radius: 10px;
        border: 1px solid #ccc;
        font-size: 15px;
        margin-bottom: 15px;
    }

    textarea { height: 120px; resize: none; }

    .row { display: flex; gap: 15px; }

    .half { width: 50%; }

    .btn {
        background: #2f74ff;
        color: white;
        padding: 13px;
        border-radius: 10px;
        cursor: pointer;
        font-size: 16px;
        border: none;
        width: 49%;
    }
    .btn:hover { opacity: 0.9; }

    .badge {
        position: absolute;
        right: 18px;
        margin-top: -42px;
        background: #2f74ff;
        color: white;
        padding: 3px 9px;
        border-radius: 20px;
        font-size: 12px;
    }

    /* --- TOOLBAR --- */
    #toolbar {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-bottom: 10px;
        position: relative;
        z-index: 1;
    }

    #toolbar button {
        padding: 6px 10px;
        background: #ddd;
        border: 1px solid #bbb;
        cursor: pointer;
        border-radius: 5px;
    }

    #toolbar button:hover {
        background: #ccc;
    }

    /* --- MESSAGE EDITOR BOX --- */
    #msgArea {
        min-height: 180px;
        background: #fff;
        border: 1px solid #ccc;
        padding: 12px;
        border-radius: 10px;
        font-size: 15px;
        outline: none;
        cursor: text;
        position: relative;
        z-index: 10;         /* MOST IMPORTANT */
        pointer-events: auto; /* FIXES CLICK ISSUE */
        overflow-y: auto;
    }

    /* Loading */
    #loading {
        display: none;
        text-align: center;
        margin-top: 15px;
        font-size: 15px;
        color: #444;
    }

    /* Success Popup */
    #successPopup {
        display: none;
        position: fixed;
        top: 40%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 25px 40px;
        border-radius: 15px;
        box-shadow: 0 5px 30px rgba(0,0,0,0.2);
        font-size: 18px;
        font-weight: bold;
    }
</style>

</head>
<body>

<div class="container">

<h2>üì® Fast Mail Launcher</h2>

<div class="row">
    <input class="half" id="sname" placeholder="Sender Name">
    <input class="half" id="gmail" placeholder="Your Gmail">
</div>

<div class="row">
    <input class="half" id="pass" placeholder="App Password">
    <input class="half" id="subject" placeholder="Subject">
</div>

<!-- Toolbar -->
<div id="toolbar">
    <button onclick="execCmd('bold')"><b>B</b></button>
    <button onclick="execCmd('italic')"><i>I</i></button>
    <button onclick="execCmd('underline')"><u>U</u></button>

    <button onclick="execCmd('insertUnorderedList')">‚Ä¢ List</button>
    <button onclick="execCmd('insertOrderedList')">1. List</button>

    <button onclick="execCmdArgs('foreColor','red')" style="color:red;">A</button>
    <button onclick="execCmdArgs('foreColor','blue')" style="color:blue;">A</button>
    <button onclick="execCmdArgs('foreColor','green')" style="color:green;">A</button>

    <select onchange="execCmdArgs('fontSize', this.value)">
        <option value="3">Font Size</option>
        <option value="2">Small</option>
        <option value="3">Normal</option>
        <option value="4">Large</option>
        <option value="5">X-Large</option>
    </select>

    <button onclick="execCmd('undo')">Undo</button>
    <button onclick="execCmd('redo')">Redo</button>
    <button onclick="execCmd('removeFormat')">Clear</button>
</div>

<!-- Message Box -->
<div id="msgArea" contenteditable="true"></div>

<br>

<!-- Email List -->
<div style="position:relative;">
    <textarea id="emails" placeholder="Recipients (comma or newline)"></textarea>
    <span id="emailCount" class="badge">0 emails</span>
</div>

<div class="row">
    <button class="btn" onclick="sendAll()">Send All</button>
    <button class="btn" style="background:#444;" onclick="logout()">Logout</button>
</div>

<div id="loading">‚è≥ Sending emails‚Ä¶</div>

</div>

<div id="successPopup">‚úî Emails Sent Successfully!</div>

<script>
function execCmd(cmd) {
    document.execCommand(cmd, false, null);
}
function execCmdArgs(cmd, arg) {
    document.execCommand(cmd, false, arg);
}

/* Email Counter */
document.getElementById("emails").addEventListener("input", () => {
    let raw = document.getElementById("emails").value
        .replace(/\n/g, ",")
        .split(",")
        .map(x => x.trim())
        .filter(x => x.length > 3);
    document.getElementById("emailCount").innerText = raw.length + " emails";
});

/* SEND ALL */
function sendAll() {
    let data = {
        sender_name: document.getElementById("sname").value,
        sender_email: document.getElementById("gmail").value,
        sender_pass: document.getElementById("pass").value,
        subject: document.getElementById("subject").value,
        message_html: document.getElementById("msgArea").innerHTML,
        recipients: document.getElementById("emails").value,
    };

    document.getElementById("loading").style.display = "block";

    fetch("/send", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify(data)
    })
    .then(r => r.json())
    .then(() => {
        document.getElementById("loading").style.display = "none";
        let p = document.getElementById("successPopup");
        p.style.display = "block";
        setTimeout(() => p.style.display = "none", 2000);
    });
}

function logout() {
    window.location.href = "/logout";
}
</script>

</body>
</html>
